import{G as W,S as B,W as C,P as F,O as G,a as R,A,b as z,c as k,d as j,R as q,e as N,V as x,f as V,M as I,g as J,h as K,i as U,j as X,B as Y}from"./vendor.f8ae2b3f.js";const $=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&l(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}};$();const O=new W,s=new B,p=new C({canvas:document.querySelector("#C")}),T=window.innerWidth,H=window.innerHeight,m=new F(45,T/H,1,1e3);m.position.set(5,10,5);p.setSize(T,H);const S=new G(m,p.domElement);p.shadowMap.enabled=!0;p.shadowMap.type=R;const Q=new A(16777215,.6),D=new z(16777215,1,50,2);D.position.set(20,10,20);O.add(D,"intensity",1,10,.1);s.add(O);s.add(D);s.add(Q);const Z=1,ee=new k(D,Z);s.add(ee);const L=new K(-1,-1);let w=new j;const _=new q,te=new N(new x(0,1,0),0);let h,i=new V,d=new x,c=new x,u=[],f=0,oe=2,M=1,y=3,b=[];g(1,65280,12,12);g(1,65280,10,10);g(1,65280,10,12);g(1,65280,12,10);g(2,16711680,0,0);ne(7,7);E();P();function P(){if(console.log(f),f+=1,f>oe&&(f=1),f!=M)setTimeout(P,1e4);else{for(let t in b)b[t].userData.movable=!0;y=b.length}}function g(t,a,o,l){let e=new j;v("15x15_basic",n=>{n.position.set(0,2,0),n.geometry.center(),n.userData.animated=!0,n.castShadow=!0,n.receiveShadow=!0,e.add(n)}),v("15x15_emissive",n=>{n.position.set(0,2,0),n.geometry.center(),n.material=new U({color:a}),n.userData.animated=!0,n.castShadow=!1,n.receiveShadow=!1,e.add(n)}),v("15x15_glass",n=>{n.position.set(0,2,0),n.geometry.center(),n.material=new X({roughness:.2,transmission:1,thickness:2,clearcoat:.3}),n.userData.animated=!0,n.castShadow=!0,n.receiveShadow=!0,e.add(n)});let r=new z(a,5,8);r.position.set(0,2,0),r.castShadow=!0,e.add(r),e.position.set(o,0,l),e.userData.health=100,e.userData.movement=2,e.userData.movable=!0,e.userData.player_id=t,e.userData.player_id==M&&(e.userData.draggable=!0,b.push(e)),console.log(e),s.add(e)}function E(){requestAnimationFrame(E),S.update(),s.traverse(function(t){t.userData.animated&&(t.rotation.x+=.01,t.rotation.y+=.01,t.rotation.z+=.01)}),p.render(s,m)}function v(t,a){const o=new I;o.setPath("../res/models/obj/"),o.load(t+".mtl",function(l){l.preload();const e=new J;e.setMaterials(l),e.setPath("../res/models/obj/"),e.load(t+".obj",function(r){a(r.children[0])})})}function ne(t,a){for(let o=0;o<t;o++)for(let l=0;l<a;l++)v("ModularFloor",e=>{e.position.set(o*2,0,l*2),e.castShadow=!0,e.receiveShadow=!0,e.userData.tile=!0,e.material[0].color.set(986895),w.add(e)});s.add(w)}window.addEventListener("mousedown",()=>{if(M==f&&(console.log("your turn"),h.length>0&&h[0].object.parent.userData.draggable&&h[0].object.parent.userData.movable)){i=h[0].object.parent,console.log(i),d=i.position.clone(),S.enableRotate=!1;let a=i.userData.movement;for(let o=0;o<w.children.length;o++)d.distanceTo(w.children[o].position)<=a*2&&u.push(w.children[o]);for(var t=0;t<u.length;t++){let o=new Y(u[t]);o.material.color.set(65280),s.add(o),u[t].userData.temp_mesh=o}}});window.addEventListener("mouseup",()=>{let t=!1;if(i){if(c.set(Math.round(i.position.x/2)*2,0,Math.round(i.position.z/2)*2),d.distanceTo(c)<=i.userData.movement*2&&d.distanceTo(c)>1){for(let o=0;o<s.children.length;o++)console.log(s.children[o]),console.log(s.children[o].position.distanceTo(c)),s.children[o].position.distanceTo(c)<=.1&&!s.children[o].userData.tile&&(t=!0,console.log(t));t?i.position.set(d.x,d.y,d.z):(i.position.set(c.x,c.y,c.z),y-=1,i.userData.movable=!1,y==0&&P())}else i.position.set(d.x,d.y,d.z);i=!1,S.enableRotate=!0;for(var a=0;a<u.length;a++)s.remove(u[a].userData.temp_mesh);console.log(y),u=[]}});window.addEventListener("mousemove",t=>{if(L.x=t.clientX/window.innerWidth*2-1,L.y=-(t.clientY/window.innerHeight)*2+1,_.setFromCamera(L,m),h=_.intersectObjects(s.children),h.length>0&&i){let a=new x;a=_.ray.intersectPlane(te,a),i.position.x=a.x,i.position.z=a.z,i.position.y=.3}});window.addEventListener("resize",()=>{p.setSize(window.innerWidth,window.innerHeight),m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix()});
